(function(z){function n(a){this.source=a}function A(a,b){this.parent=a;this.other=b}function s(a,b){if(a instanceof s)throw"Sequence is already asynchronous!";this.parent=a;this.onNextCallback=ha(b)}function ha(a){if("undefined"===typeof a){if("function"===typeof z.setImmediate)return z.setImmediate;if("undefined"!==typeof B&&"function"===typeof B.nextTick)return B.nextTick}a=a||0;return function(b){setTimeout(b,a)}}function h(){}function w(a){this.source=a;this.index=-1}function q(a,b){this.parent=
a;this.filterFn=b}function C(a,b){this.parent=a;this.filterFn=b}function D(a,b){this.parent=a;this.filterFn=b}function E(a,b){this.iterator=a.getIterator();this.filterFn=b}function t(a,b){this.get=a;this.fixedLength=b}function g(){}function R(a){var b=new u;l(a||[]).flatten().each(function(a){b.add(a)});return b}function F(a,b,d){return"function"===typeof d?F(d(a),d(b)):a===b?0:a>b?1:-1}function S(a,b,d){d=d||[0];for(var e=-1;++e<a.length;)if(a[e]instanceof Array){if(!1===S(a[e],b,d))return!1}else if(!1===
b(a[e],d[0]++))return!1;return!0}function ia(a){var b;a.each(function(a){b=a;return!1});return b}function r(a,b){for(var d=-1,e=a.length;++d<e;)if(a[d]===b)return!0;return!1}function ja(a){return Array(a).join("  ")}function G(a){this.parent=a}function H(a){this.sequence=a;this.index=-1}function v(a,b){this.source=a;this.mapFn=b}function k(){}function x(a){this.source=a}function I(a,b){this.parent=a;this.properties=b}function J(a,b){this.parent=a;this.properties=b}function c(){}function u(){this.table=
{}}function K(a,b){this.source=a;this.pattern=eval(""+b+(!b.global?"g":""))}function L(a,b){this.source=a;this.delimiter=b}function M(a,b){this.source=a;this.pattern=eval(""+b+(!b.global?"g":""))}function N(a){this.source=a}function p(a){this.parent=a;a=a.source;a=200>a.length?p.prototype.eachNoCache:800>a.length?p.prototype.eachArrayCache:y.prototype.each;this.each=a}n.prototype=new g;n.prototype.get=function(a){return this.source[a]};n.prototype.length=function(){return this.source.length};n.prototype.each=
function(a){for(var b=-1;++b<this.source.length&&!1!==a(this.source[b],b););};n.prototype.map=function(a){return new v(this.source,a)};n.prototype.filter=function(a){return new D(this,a)};n.prototype.uniq=n.prototype.unique=function(){return new p(this)};n.prototype.toArray=function(){return this.source.slice(0)};A.prototype=new k;A.prototype.each=function(a){var b=new u,d=!1;l(this.other).each(function(e,c){if(!1===a(e,c))return d=!0,!1;b.add(c)});d||this.parent.each(function(d,c){if(!b.contains(c)&&
!1===a(d,c))return!1})};s.prototype=new c;s.prototype.each=function(a){var b=this.parent.getIterator(),d=this.onNextCallback;b.moveNext()&&d(function f(){!1!==a(b.current())&&b.moveNext()&&d(f)})};h.prototype=new c;h.inherit=function(a){a.prototype=new h;return a};h.prototype.cache=function(){this.cached||(this.cached=this.toArray());return this.cached};h.prototype.get=function(a){return this.cache()[a]};h.prototype.length=function(){return this.cache().length};w.prototype.current=function(){return this.source.charAt(this.index)};
w.prototype.moveNext=function(){return++this.index<this.source.length};var T=c.inherit(function(a,b){this.parent=a;this.arrays=b});T.prototype.each=function(a){var b=!1,d=0;this.parent.each(function(e){if(!1===a(e,d++))return b=!0,!1});b||l(this.arrays).flatten().each(function(b){if(!1===a(b,d++))return!1})};var ka=h.inherit(function(a,b){this.each=function(d){var e={};a.each(function(a){a=b(a);e[a]=e[a]?e[a]+1:1});for(var c in e)d([c,e[c]])}}),U=h.inherit(function(a,b){this.parent=a;this.count="number"===
typeof b?b:1});U.prototype.each=function(a){var b=this,d=0;b.parent.each(function(e){if(!(d++<b.count))return a(e)})};var O=g.inherit(function(a,b){this.parent=a;this.count="number"===typeof b?b:1});O.prototype.get=function(a){return this.parent.get(this.count+a)};O.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0};var B;q.prototype=new h;q.prototype.getIterator=function(){return new E(this.parent,this.filterFn)};q.prototype.each=function(a){var b=this.filterFn;
this.parent.each(function(d,e){if(b(d,e))return a(d,e)})};C.prototype=new q;C.prototype.each=function(a){for(var b=this.parent,d=this.filterFn,e=this.parent.length(),c=-1,m;++c<e&&!(m=b.get(c),d(m,c)&&!1===a(m,c)););};D.prototype=new q;D.prototype.each=function(a){for(var b=this.parent.source,d=this.filterFn,c=b.length,f=-1,m;++f<c&&!(m=b[f],d(m,f)&&!1===a(m,f)););};E.prototype.current=function(){return this.value};E.prototype.moveNext=function(){for(var a=this.iterator,b=this.filterFn,d;a.moveNext();)if(d=
a.current(),b(d))return this.value=d,!0;this.value=void 0;return!1};var V=h.inherit(function(a){this.parent=a});V.prototype.each=function(a){var b=[0];this.parent.each(function(d){return d instanceof Array?S(d,a,b):a(d,b[0]++)})};t.prototype=new c;t.prototype.length=function(){return this.fixedLength};t.prototype.each=function(a){for(var b=this.get,d=this.fixedLength,c=0;("undefined"===typeof d||c<d)&&!1!==a(b(c++)););};var la=h.inherit(function(a,b){this.each=function(d){var c={};a.each(function(a){var d=
b(a);c[d]?c[d].push(a):c[d]=[a]});for(var f in c)if(!1===d([f,c[f]]))break}});g.prototype=new c;g.inherit=function(a){a.prototype=new g;return a};g.prototype.get=function(a){return this.parent.get(a)};g.prototype.length=function(){return this.parent.length()};g.prototype.each=function(a){for(var b=this.length(),d=-1;++d<b&&!1!==a(this.get(d),d););};g.prototype.map=g.prototype.collect=function(a){return new W(this,a)};g.prototype.filter=g.prototype.select=function(a){return new C(this,a)};g.prototype.reverse=
function(){return new X(this)};g.prototype.first=function(a){return"undefined"===typeof a?this.get(0):new Y(this,a)};g.prototype.head=g.prototype.take=g.prototype.first;g.prototype.rest=function(a){return new O(this,a)};g.prototype.tail=g.prototype.drop=g.prototype.rest;var l=function(a){return a instanceof c?a:"string"===typeof a?new N(a):a instanceof Array?new n(a):new x(a)};l.async=function(a,b){return new s(new n(a),b)};l.generate=function(a,b){return new t(a,b)};l.range=function(){var a=1<arguments.length?
arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],d=2<arguments.length?arguments[2]:1;return this.generate(function(b){return a+d*b}).take(Math.floor((b-a)/d))};l.repeat=function(a,b){return l.generate(function(){return a},b)};l.Sequence=c;l.IndexedSequence=g;l.CachingSequence=h;l.GeneratedSequence=t;"function"===typeof Array.prototype.indexOf&&(r=function(a,b){return-1!==a.indexOf(b)});z.Lazy=l;var Z=h.inherit(function(a,b){this.parent=a;this.arrays=b});Z.prototype.each=function(a){var b=
l(this.arrays).map(function(a){return R(a)}).toArray(),d=0;this.parent.each(function(c){for(var f=-1;++f<b.length;)if(!b[f].contains(c))return;return a(c,d++)})};G.prototype=new k;G.prototype.each=function(a){this.parent.each(function(b,d){return a(d,b)})};H.prototype.current=function(){return this.sequence.get(this.index)};H.prototype.moveNext=function(){if(this.index>=this.sequence.length()-1)return!1;++this.index;return!0};var $=c.inherit(function(a,b){this.parent=a;this.mapFn=b});$.prototype.each=
function(a){var b=this.mapFn;this.parent.each(function(d,c){return a(b(d,c),c)})};var W=g.inherit(function(a,b){this.parent=a;this.mapFn=b});W.prototype.get=function(a){return this.mapFn(this.parent.get(a),a)};v.prototype=new g;v.prototype.get=function(a){return this.mapFn(this.source[a])};v.prototype.length=function(){return this.source.length};v.prototype.each=function(a){for(var b=this.source,d=this.source.length,c=this.mapFn,f=-1;++f<d&&!1!==a(c(b[f],f),f););};k.prototype=new c;k.prototype.keys=
function(){return this.map(function(a,b){return b})};k.prototype.values=function(){return this.map(function(a,b){return a})};k.prototype.assign=function(a){return new A(this,a)};k.prototype.extend=k.prototype.assign;k.prototype.invert=function(){return new G(this)};k.prototype.functions=function(){return this.filter(function(a,b){return"function"===typeof a}).map(function(a,b){return b})};k.prototype.methods=k.prototype.functions;k.prototype.pick=function(a){return new J(this,a)};k.prototype.omit=
function(a){return new I(this,a)};k.prototype.toArray=function(){return this.map(function(a,b){return[b,a]}).toArray()};k.prototype.pairs=k.prototype.toArray;k.prototype.toObject=function(){return this.map(function(a,b){return[b,a]}).toObject()};x.prototype=new k;x.prototype.get=function(a){return this.source[a]};x.prototype.each=function(a){var b=this.source,d;for(d in b)if(!1===a(b[d],d))break};I.prototype=new k;I.prototype.each=function(a){var b=r,d=this.properties;this.parent.each(function(c,
f){if(!b(d,f))return a(c,f)})};J.prototype=new k;J.prototype.each=function(a){var b=r,d=this.properties;this.parent.each(function(c,f){if(b(d,f))return a(c,f)})};var aa=h.inherit(function(a){this.parent=a});aa.prototype.each=function(a){for(var b=this.parent.toArray(),d=b.length;0<=--d&&!1!==a(b[d]););};var X=g.inherit(function(a){this.parent=a});X.prototype.get=function(a){return this.parent.get(this.length()-a-1)};c.inherit=function(a){a.prototype=new c;return a};c.prototype.depth=function(){return this.parent?
this.parent.depth()+1:0};c.prototype.log=function(a){(void 0).log(ja(this.depth())+a)};c.prototype.toArray=function(){var a=[];this.each(function(b){a.push(b)});return a};c.prototype.toObject=function(){var a={};this.each(function(b){a[b[0]]=b[1]});return a};c.prototype.forEach=function(a){this.each(a)};c.prototype.map=function(a){return new $(this,a)};c.prototype.collect=c.prototype.map;c.prototype.pluck=function(a){return this.map(function(b){return b[a]})};c.prototype.invoke=function(a){return this.map(function(b){return b[a]()})};
c.prototype.select=function(a){return new q(this,a)};c.prototype.filter=c.prototype.select;c.prototype.reject=function(a){return this.filter(function(b){return!a(b)})};c.prototype.where=function(a){return this.filter(function(b){for(var d in a)if(b[d]!==a[d])return!1;return!0})};c.prototype.reverse=function(){return new aa(this)};c.prototype.concat=function(a){return new T(this,Array.prototype.slice.call(arguments,0))};c.prototype.first=function(a){return"undefined"===typeof a?ia(this):new ba(this,
a)};c.prototype.head=c.prototype.take=c.prototype.first;c.prototype.initial=function(a){"undefined"===typeof a&&(a=1);return this.take(this.length()-a)};c.prototype.last=function(a){return"undefined"===typeof a?this.reverse().first():this.reverse().take(a).reverse()};c.prototype.findWhere=function(a){return this.where(a).first()};c.prototype.rest=function(a){return new U(this,a)};c.prototype.tail=c.prototype.drop=c.prototype.rest;c.prototype.sortBy=function(a){return new ca(this,a)};c.prototype.groupBy=
function(a){return new la(this,a)};c.prototype.countBy=function(a){return new ka(this,a)};c.prototype.uniq=function(){return new y(this)};c.prototype.unique=c.prototype.uniq;c.prototype.zip=function(a){return new da(this,Array.prototype.slice.call(arguments,0))};c.prototype.shuffle=function(){return new ea(this)};c.prototype.flatten=function(){return new V(this)};c.prototype.compact=function(){return this.filter(function(a){return!!a})};c.prototype.without=function(a){return new fa(this,Array.prototype.slice.call(arguments,
0))};c.prototype.difference=c.prototype.without;c.prototype.union=function(a){return new ga(this,Array.prototype.slice.call(arguments,0))};c.prototype.intersection=function(a){return new Z(this,Array.prototype.slice.call(arguments,0))};c.prototype.every=function(a){var b=!0;this.each(function(d){if(!a(d))return b=!1});return b};c.prototype.all=c.prototype.every;c.prototype.some=function(a){a||(a=function(){return!0});var b=!1;this.each(function(d){if(a(d))return b=!0,!1});return b};c.prototype.any=
c.prototype.some;c.prototype.isEmpty=function(){return!this.any()};c.prototype.indexOf=function(a){var b=0,d=-1;this.each(function(c){if(c===a)return d=b,!1;++b});return d};c.prototype.lastIndexOf=function(a){a=this.reverse().indexOf(a);-1!==a&&(a=this.length()-a-1);return a};c.prototype.sortedIndex=function(a){for(var b=0,d=this.length(),c;b<d;)c=b+d>>>1,-1===F(this.get(c),a)?b=c+1:d=c;return b};c.prototype.contains=function(a){return-1!==this.indexOf(a)};c.prototype.reduce=function(a,b){if(2>arguments.length)return this.tail().reduce(a,
this.head());this.each(function(c,e){b=a(b,c,e)});return b};c.prototype.inject=c.prototype.foldl=c.prototype.reduce;c.prototype.reduceRight=function(a,b){var c=this.length()-1;return this.reverse().reduce(function(b,f){return a(b,f,c--)},b)};c.prototype.foldr=c.prototype.reduceRight;c.prototype.find=function(a){return this.filter(a).first()};c.prototype.detect=c.prototype.find;c.prototype.min=function(){return this.reduce(function(a,b){return b<a?b:a})};c.prototype.max=function(){return this.reduce(function(a,
b){return b>a?b:a})};c.prototype.sum=function(){return this.reduce(function(a,b){return a+b},0)};c.prototype.join=function(a){var b="";this.each(function(c){0<b.length&&(b+=a);b+=c});return b};c.prototype.getIterator=function(){return new H(this)};c.prototype.async=function(a){return new s(this,a)};u.prototype.add=function(a){var b=this.table,c="@"+a;if(!b[c])return b[c]=[a],!0;if(r(b[c],a))return!1;b[c].push(a);return!0};u.prototype.contains=function(a){var b=this.table["@"+a];return b&&r(b,a)};
var ea=h.inherit(function(a){this.parent=a});ea.prototype.each=function(a){for(var b=this.parent.toArray(),c=Math.floor,e=Math.random,f=0,m=b.length-1;0<m;--m){var g=b,h=c(e()*m)+1,k=g[m];g[m]=g[h];g[h]=k;if(!1===a(b[m],f++))return}a(b[0],f)};var ca=h.inherit(function(a,b){this.parent=a;this.sortFn=b});ca.prototype.each=function(a){var b=this.sortFn,c=this.parent.toArray(),e=-1;for(c.sort(function(a,c){return F(a,c,b)});++e<c.length&&!1!==a(c[e],e););};var P=c.inherit(function(a,b){this.source=a;
this.pattern=b});P.prototype.each=function(a){for(var b=this.getIterator();b.moveNext()&&!1!==a(b.current()););};P.prototype.getIterator=function(){return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new w(this.source):new K(this.source,this.pattern):""===this.pattern?new w(this.source):new L(this.source,this.pattern)};K.prototype.current=function(){return this.source.substring(this.start,this.end)};K.prototype.moveNext=function(){if(!this.pattern)return!1;
var a=this.pattern.exec(this.source);return a?(this.start=this.nextStart?this.nextStart:0,this.end=a.index,this.nextStart=a.index+a[0].length,!0):this.pattern?(this.start=this.nextStart,this.pattern=this.nextStart=this.end=void 0,!0):!1};L.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)};L.prototype.moveNext=function(){this.finished||(this.leftIndex="undefined"!==typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,
this.leftIndex));return-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished};M.prototype.current=function(){return this.match[0]};M.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))};var Q=c.inherit(function(a,b){this.source=a;this.pattern=b});Q.prototype.each=function(a){for(var b=this.getIterator();b.moveNext()&&!1!==a(b.current()););};Q.prototype.getIterator=function(){return new M(this.source,this.pattern)};N.prototype.match=function(a){return new Q(this.source,
a)};N.prototype.split=function(a){return new P(this.source,a)};var ba=h.inherit(function(a,b){this.parent=a;this.count=b});ba.prototype.each=function(a){var b=this,c=0;b.parent.each(function(e){e=a(e);return++c>=b.count?!1:e})};var Y=g.inherit(function(a,b){this.parent=a;this.count=b});Y.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a};var ga=h.inherit(function(a,b){this.parent=a;this.arrays=b});ga.prototype.each=function(a){var b={},c=0,e=!1;this.parent.each(function(f){if(!b[f]&&
(b[f]=!0,!1===a(f,c++)))return e=!0,!1});e||l(this.arrays).each(function(f){if(e)return!1;l(f).each(function(f){if(!b[f]&&(b[f]=!0,!1===a(f,c++)))return e=!0,!1})})};var y=h.inherit(function(a){this.parent=a});y.prototype.each=function(a){var b=new u,c=0;this.parent.each(function(e){if(b.add(e))return a(e,c++)})};p.prototype=new h;p.prototype.eachNoCache=function(a){for(var b=this.parent.source,c=b.length,e,f,g=-1,h,k=0;++g<c;){e=b[g];f=!1;for(h=g-1;0<=h;)if(b[h--]===e){f=!0;break}if(!f&&!1===a(b[g],
k++))return!1}};p.prototype.eachArrayCache=function(a){for(var b=this.parent.source,c=b.length,e=[],f,g=-1,h=0;++g<c;)if(f=b[g],!r(e,f)&&(e.push(f),!1===a(f,h++)))return!1};p.prototype.eachSetCache=y.prototype.each;var fa=h.inherit(function(a,b){this.parent=a;this.values=b});fa.prototype.each=function(a){var b=R(this.values),c=0;this.parent.each(function(e){if(!b.contains(e))return a(e,c++)})};var da=h.inherit(function(a,b){this.parent=a;this.arrays=b});da.prototype.each=function(a){var b=this.arrays,
c=0;this.parent.each(function(e){e=[e];for(var f=0;f<b.length;++f)b[f].length>c&&e.push(b[f][c]);return a(e,c++)})}})("undefined"!==typeof global?global:window);
